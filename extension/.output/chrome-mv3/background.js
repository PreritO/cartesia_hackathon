var background=(function(){"use strict";function c(t){return t==null||typeof t=="function"?{main:t}:t}let n=null,o=!1;function r(t){chrome.storage.session.set({commentatorState:t})}async function u(){(await chrome.runtime.getContexts({contextTypes:["OFFSCREEN_DOCUMENT"]})).length>0||await chrome.offscreen.createDocument({url:"offscreen.html",reasons:["USER_MEDIA"],justification:"Capture tab video frames for AI sports commentary"})}async function d(){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t?.id){r({active:!1,status:"No active tab found",tabId:null});return}n=t.id;try{const e=await chrome.tabCapture.getMediaStreamId({targetTabId:t.id});await u(),o=!0,r({active:!0,status:"Starting capture...",tabId:t.id}),chrome.runtime.sendMessage({type:"CAPTURE_STARTED",streamId:e,tabId:t.id})}catch(e){const i=e instanceof Error?e.message:"Unknown error";r({active:!1,status:`Capture failed: ${i}`,tabId:null}),o=!1,n=null}}async function l(){o=!1,n=null,chrome.runtime.sendMessage({type:"STOP_CAPTURE"}),r({active:!1,status:"Stopped",tabId:null})}chrome.runtime.onMessage.addListener((t,e,i)=>{if(t.type==="START_CAPTURE")return d().then(()=>i({ok:!0})),!0;if(t.type==="STOP_CAPTURE")return l().then(()=>i({ok:!0})),!0;t.type==="STATUS"&&r({active:o,status:t.message,tabId:n})});const f=c(()=>{console.log("[AI Commentator] Service worker started"),chrome.action.onClicked.addListener(t=>{t.windowId&&chrome.sidePanel.open({windowId:t.windowId})})});function b(){}globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;function a(t,...e){}const m={debug:(...t)=>a(console.debug,...t),log:(...t)=>a(console.log,...t),warn:(...t)=>a(console.warn,...t),error:(...t)=>a(console.error,...t)};let s;try{s=f.main(),s instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(t){throw m.error("The background crashed on startup!"),t}var h=s;return h})();
