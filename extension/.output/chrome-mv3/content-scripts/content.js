var content=(function(){"use strict";function L(e){return e}const w=5,b=.7,u=1280;let a=null,o=null,g=!1;function c(){return document.querySelector("video")}function S(e){const t=c();if(!t){e.postMessage({type:"ERROR",message:"No video element found"});return}g=t.muted,t.muted=!0;const n=document.createElement("canvas"),i=n.getContext("2d");T(),a=setInterval(()=>{if(!t||t.readyState<t.HAVE_CURRENT_DATA)return;let r=t.videoWidth,s=t.videoHeight;if(r===0||s===0)return;if(r>u){const U=u/r;r=u,s=Math.round(s*U)}(n.width!==r||n.height!==s)&&(n.width=r,n.height=s),i.drawImage(t,0,0,r,s);const _=n.toDataURL("image/jpeg",b).split(",")[1];e.postMessage({type:"FRAME",data:_,ts:Date.now()})},1e3/w),e.postMessage({type:"CAPTURE_ACTIVE"})}function v(){a&&(clearInterval(a),a=null),f();const e=c();e&&(e.muted=g)}function T(){f();const e=c();if(!e)return;const t=e.closest(".html5-video-player")||e.parentElement;if(!t||!(t instanceof HTMLElement))return;getComputedStyle(t).position==="static"&&(t.style.position="relative"),o=document.createElement("div"),o.id="ai-commentator-overlay",o.style.cssText=`
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(15, 23, 42, 0.92);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    pointer-events: none;
    font-family: system-ui, -apple-system, sans-serif;
  `,o.innerHTML=`
    <div style="text-align: center; color: white;">
      <div style="font-size: 48px; margin-bottom: 12px;">&#127908;</div>
      <div style="font-size: 18px; font-weight: 700; margin-bottom: 6px;">AI Commentary Active</div>
      <div style="font-size: 14px; color: #94a3b8;">Watch the synced broadcast in the sidebar</div>
    </div>
  `,t.appendChild(o)}function f(){o&&(o.remove(),o=null)}const I={matches:["*://*.youtube.com/*"],runAt:"document_idle",main(){console.log("[AI Commentator] Content script loaded on YouTube page"),chrome.runtime.onConnect.addListener(e=>{e.name==="capture"&&(console.log("[AI Commentator] Capture port connected"),e.onMessage.addListener(t=>{t.type==="START_CAPTURE"&&S(e),t.type==="STOP_CAPTURE"&&v()}),e.onDisconnect.addListener(()=>{console.log("[AI Commentator] Capture port disconnected"),v()}))}),chrome.runtime.onMessage.addListener((e,t,n)=>{const i=c();if(!i){n({ok:!1,error:"No video element found"});return}switch(e.type){case"VIDEO_PLAY":i.play(),n({ok:!0});break;case"VIDEO_PAUSE":i.pause(),n({ok:!0});break;case"VIDEO_MUTE":i.muted=!0,n({ok:!0});break;case"VIDEO_UNMUTE":i.muted=!1,n({ok:!0});break;case"VIDEO_STATUS":n({ok:!0,paused:i.paused,muted:i.muted,currentTime:i.currentTime,duration:i.duration});break;default:n({ok:!1,error:"Unknown message type"})}})}};function l(e,...t){}const C={debug:(...e)=>l(console.debug,...e),log:(...e)=>l(console.log,...e),warn:(...e)=>l(console.warn,...e),error:(...e)=>l(console.error,...e)},p=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;var y=class E extends Event{static EVENT_NAME=m("wxt:locationchange");constructor(t,n){super(E.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};function m(e){return`${p?.runtime?.id}:content:${e}`}function A(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let i=new URL(location.href);i.href!==n.href&&(window.dispatchEvent(new y(i,n)),n=i)},1e3))}}}var x=class h{static SCRIPT_STARTED_MESSAGE_TYPE=m("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=A(this);receivedMessageIds=new Set;constructor(t,n){this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return p.runtime?.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const i=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(i)),i}setTimeout(t,n){const i=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(i)),i}requestAnimationFrame(t){const n=requestAnimationFrame((...i)=>{this.isValid&&t(...i)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const i=requestIdleCallback((...r)=>{this.signal.aborted||t(...r)},n);return this.onInvalidated(()=>cancelIdleCallback(i)),i}addEventListener(t,n,i,r){n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),t.addEventListener?.(n.startsWith("wxt:")?m(n):n,i,{...r,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),C.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:h.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){const n=t.data?.type===h.SCRIPT_STARTED_MESSAGE_TYPE,i=t.data?.contentScriptName===this.contentScriptName,r=!this.receivedMessageIds.has(t.data?.messageId);return n&&i&&r}listenForNewerScripts(t){let n=!0;const i=r=>{if(this.verifyScriptStartedEvent(r)){this.receivedMessageIds.add(r.data.messageId);const s=n;if(n=!1,s&&t?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",i),this.onInvalidated(()=>removeEventListener("message",i))}};function k(){}function d(e,...t){}const M={debug:(...e)=>d(console.debug,...e),log:(...e)=>d(console.log,...e),warn:(...e)=>d(console.warn,...e),error:(...e)=>d(console.error,...e)};return(async()=>{try{const{main:e,...t}=I;return await e(new x("content",t))}catch(e){throw M.error('The content script "content" crashed on startup!',e),e}})()})();
content;