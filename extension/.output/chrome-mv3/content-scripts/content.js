var content=(function(){"use strict";function F(t){return t}const I=5,y=.7,p=1280;let l=null,d=null,c=null,u=null,i=null,E=!1;function s(){return document.querySelector("video")}function A(t){const e=s();if(!e){t.postMessage({type:"ERROR",message:"No video element found"});return}d=t,E=e.muted,e.muted=!0,c=document.createElement("canvas"),u=c.getContext("2d"),x(),b(),t.postMessage({type:"CAPTURE_ACTIVE"})}function b(){f();const t=s();if(!t||!u||!c||!d)return;const e=c,n=u,r=d;l=setInterval(()=>{if(!t||t.readyState<t.HAVE_CURRENT_DATA)return;let o=t.videoWidth,a=t.videoHeight;if(o===0||a===0)return;if(o>p){const D=p/o;o=p,a=Math.round(a*D)}(e.width!==o||e.height!==a)&&(e.width=o,e.height=a),n.drawImage(t,0,0,o,a);const V=e.toDataURL("image/jpeg",y).split(",")[1];r.postMessage({type:"FRAME",data:V,ts:Date.now()})},1e3/I)}function f(){l&&(clearInterval(l),l=null)}function w(){f(),d=null,c=null,u=null,C();const t=s();t&&(t.muted=E)}function U(){f();const t=s();t&&t.pause()}function _(){const t=s();t&&t.play(),b()}function x(){C();const t=s();if(!t)return;const e=t.closest(".html5-video-player")||t.parentElement;if(!e||!(e instanceof HTMLElement))return;getComputedStyle(e).position==="static"&&(e.style.position="relative"),i=document.createElement("div"),i.id="ai-commentator-overlay",i.style.cssText=`
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(15, 23, 42, 0.92);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    pointer-events: none;
    font-family: system-ui, -apple-system, sans-serif;
  `,i.innerHTML=`
    <div style="text-align: center; color: white;">
      <div style="font-size: 48px; margin-bottom: 12px;">&#127908;</div>
      <div style="font-size: 18px; font-weight: 700; margin-bottom: 6px;">AI Commentary Active</div>
      <div style="font-size: 14px; color: #94a3b8;">Watch the synced broadcast in the sidebar</div>
    </div>
  `,e.appendChild(i)}function C(){i&&(i.remove(),i=null)}const M={matches:["*://*.youtube.com/*"],runAt:"document_idle",main(){console.log("[AI Commentator] Content script loaded on YouTube page"),chrome.runtime.onConnect.addListener(t=>{t.name==="capture"&&(console.log("[AI Commentator] Capture port connected"),t.onMessage.addListener(e=>{switch(e.type){case"START_CAPTURE":A(t);break;case"STOP_CAPTURE":w();break;case"PAUSE_CAPTURE":U();break;case"RESUME_CAPTURE":_();break}}),t.onDisconnect.addListener(()=>{console.log("[AI Commentator] Capture port disconnected"),w()}))}),chrome.runtime.onMessage.addListener((t,e,n)=>{const r=s();if(!r){n({ok:!1,error:"No video element found"});return}switch(t.type){case"VIDEO_PLAY":r.play(),n({ok:!0});break;case"VIDEO_PAUSE":r.pause(),n({ok:!0});break;case"VIDEO_MUTE":r.muted=!0,n({ok:!0});break;case"VIDEO_UNMUTE":r.muted=!1,n({ok:!0});break;case"VIDEO_STATUS":n({ok:!0,paused:r.paused,muted:r.muted,currentTime:r.currentTime,duration:r.duration});break;default:n({ok:!1,error:"Unknown message type"})}})}};function m(t,...e){}const k={debug:(...t)=>m(console.debug,...t),log:(...t)=>m(console.log,...t),warn:(...t)=>m(console.warn,...t),error:(...t)=>m(console.error,...t)},S=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;var L=class T extends Event{static EVENT_NAME=v("wxt:locationchange");constructor(e,n){super(T.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=n}};function v(t){return`${S?.runtime?.id}:content:${t}`}function P(t){let e,n;return{run(){e==null&&(n=new URL(location.href),e=t.setInterval(()=>{let r=new URL(location.href);r.href!==n.href&&(window.dispatchEvent(new L(r,n)),n=r)},1e3))}}}var N=class g{static SCRIPT_STARTED_MESSAGE_TYPE=v("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=P(this);receivedMessageIds=new Set;constructor(e,n){this.contentScriptName=e,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return S.runtime?.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,n){const r=setInterval(()=>{this.isValid&&e()},n);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(e,n){const r=setTimeout(()=>{this.isValid&&e()},n);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(e){const n=requestAnimationFrame((...r)=>{this.isValid&&e(...r)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(e,n){const r=requestIdleCallback((...o)=>{this.signal.aborted||e(...o)},n);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(e,n,r,o){n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),e.addEventListener?.(n.startsWith("wxt:")?v(n):n,r,{...o,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),k.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:g.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){const n=e.data?.type===g.SCRIPT_STARTED_MESSAGE_TYPE,r=e.data?.contentScriptName===this.contentScriptName,o=!this.receivedMessageIds.has(e.data?.messageId);return n&&r&&o}listenForNewerScripts(e){let n=!0;const r=o=>{if(this.verifyScriptStartedEvent(o)){this.receivedMessageIds.add(o.data.messageId);const a=n;if(n=!1,a&&e?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};function W(){}function h(t,...e){}const R={debug:(...t)=>h(console.debug,...t),log:(...t)=>h(console.log,...t),warn:(...t)=>h(console.warn,...t),error:(...t)=>h(console.error,...t)};return(async()=>{try{const{main:t,...e}=M;return await t(new N("content",e))}catch(t){throw R.error('The content script "content" crashed on startup!',t),t}})()})();
content;